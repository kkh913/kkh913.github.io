{"componentChunkName":"component---src-templates-blog-post-js","path":"/OKD/installation-guide-for-okd-3.11/","result":{"data":{"site":{"siteMetadata":{"title":"kkh913's Developer Blog","author":"[kkh913]","siteUrl":"https://kkh913.github.io","comment":{"disqusShortName":"","utterances":"kkh913/utterances"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"dc10e256-926e-55ef-b0f9-ed9d612d2fd5","excerpt":"Clustering Prepare before ansible-playbook ‚ÄºÔ∏è(Very Important) NM_CONTROLLED If you don‚Äôt want to be in an infinite panic‚Ä¶ see below.   FAILED - RETRYING: Wait for the ServiceMonitor CRD to be created ¬∑ Issue #10427 ¬∑ openshift/openshift-ansible For the all nodes  Passwordless SSH‚Ä¶","html":"<h1 id=\"clustering\" style=\"position:relative;\"><a href=\"#clustering\" aria-label=\"clustering permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Clustering</h1>\n<h2 id=\"prepare-before-ansible-playbook\" style=\"position:relative;\"><a href=\"#prepare-before-ansible-playbook\" aria-label=\"prepare before ansible playbook permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prepare before ansible-playbook</h2>\n<h3 id=\"Ô∏èvery-important-nm_controlled\" style=\"position:relative;\"><a href=\"#%EF%B8%8Fvery-important-nm_controlled\" aria-label=\"Ô∏èvery important nm_controlled permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>‚ÄºÔ∏è(Very Important) NM_CONTROLLED</h3>\n<p>If you don‚Äôt want to be in an infinite panic‚Ä¶ see below.  </p>\n<p><a href=\"https://github.com/openshift/openshift-ansible/issues/10427#\">FAILED - RETRYING: Wait for the ServiceMonitor CRD to be created ¬∑ Issue #10427 ¬∑ openshift/openshift-ansible</a></p>\n<p>For the all nodes </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> <span class=\"token assign-left variable\">NM_CONTROLLED</span><span class=\"token operator\">=</span>yes <span class=\"token operator\">>></span> /etc/sysconfig/network-scripts/ifcfg-eth0</code></pre></div>\n<h3 id=\"passwordless-ssh\" style=\"position:relative;\"><a href=\"#passwordless-ssh\" aria-label=\"passwordless ssh permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Passwordless SSH</h3>\n<p>For <code class=\"language-text\">master01</code>  </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ssh-keygen -q -N <span class=\"token string\">\"\"</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">host</span> <span class=\"token keyword\">in</span> master01.okd.jitsi node01.okd.jitsi node02.okd.jitsi<span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span> ssh-copy-id <span class=\"token variable\">$host</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span></code></pre></div>\n<h3 id=\"install-packages-from-repo\" style=\"position:relative;\"><a href=\"#install-packages-from-repo\" aria-label=\"install packages from repo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install packages from repo</h3>\n<p>For <code class=\"language-text\">master01</code> </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span>\nyum <span class=\"token function\">install</span> -y <span class=\"token function\">vim</span> <span class=\"token function\">git</span> yum-utils centos-release-openshift-origin311.noarch\nyum <span class=\"token function\">install</span> -y openshift-ansible</code></pre></div>\n<p>Optional‚Ä¶ just for me, not you üòÑ) Install <code class=\"language-text\">fzf</code> and <code class=\"language-text\">ripgrep</code> on all nodes  </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span>\nyum <span class=\"token function\">install</span> -y <span class=\"token function\">git</span> yum-utils\n<span class=\"token comment\"># git clone -b release-3.11 https://github.com/openshift/openshift-ansible # if required</span>\nyum-config-manager --add-repo<span class=\"token operator\">=</span>https://copr.fedorainfracloud.org/coprs/carlwgeorge/ripgrep/repo/epel-6/carlwgeorge-ripgrep-epel-7.repo\nyum <span class=\"token function\">install</span> -y ripgrep \n<span class=\"token function\">git</span> clone --depth <span class=\"token number\">1</span> https://github.com/junegunn/fzf.git ~/.fzf\n~/.fzf/install\n<span class=\"token comment\"># log out/in required</span></code></pre></div>\n<h3 id=\"configuring-docker-storage\" style=\"position:relative;\"><a href=\"#configuring-docker-storage\" aria-label=\"configuring docker storage permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configuring Docker Storage</h3>\n<p>For all nodes except <code class=\"language-text\">dns01</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">yum <span class=\"token function\">install</span> -y docker-1.13.1 \n<span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">EOF<span class=\"token bash punctuation\"> <span class=\"token operator\">></span> /etc/sysconfig/docker-storage-setup</span>\nDEVS=/dev/sdb\nVG=docker-vg\nEOF</span>\ndocker-storage-setup\nsystemctl <span class=\"token builtin class-name\">enable</span> --now docker</code></pre></div>\n<h2 id=\"run-ansible-playbook\" style=\"position:relative;\"><a href=\"#run-ansible-playbook\" aria-label=\"run ansible playbook permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Run ansible-playbook</h2>\n<p>Create <code class=\"language-text\">hosts.jitsi</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /usr/share/ansible/openshift-ansible\n<span class=\"token function\">cat</span> <span class=\"token operator\">></span> inventory/hosts.jitsi <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">END\n[OSEv3:children]\nmasters\nnodes\netcd\n\n[OSEv3:vars]\nopenshift_deployment_type=origin\nopenshift_portal_net=172.30.0.0/16\nopenshift_disable_check=disk_availability,memory_availability,docker_image_availability\n# os_firewall_use_firewalld=True\n\n[masters]\nmaster01.okd.jitsi\n\n[etcd]\nmaster01.okd.jitsi\n\n[nodes]\nmaster01.okd.jitsi openshift_node_group_name=\"node-config-master-infra\"\nnode0[1:2].okd.jitsi openshift_node_group_name=\"node-config-compute\"\nEND</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ansible-playbook -i inventory/hosts.jitsi playbooks/prerequisites.yml </code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ansible-playbook -i inventory/hosts.jitsi playbooks/deploy_cluster.yml</code></pre></div>\n<h2 id=\"troubleshooting\" style=\"position:relative;\"><a href=\"#troubleshooting\" aria-label=\"troubleshooting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Troubleshooting</h2>\n<ol>\n<li>\n<p>‚ÄòNoneType‚Äô object has no attribute ‚Äô<strong>getitem</strong>‚Äò‚Äù</p>\n<p><a href=\"https://access.redhat.com/solutions/4981431\">Certificate expiry playbook failed with error ‚Äòlast<em>checked</em>var: ansible_python;‚ÄòNoneType‚Äô object has no attribute ‚Äô<strong>getitem</strong>‚Äô‚Äù‚Äô - Red Hat Customer Portal</a></p>\n<ul>\n<li>Modify your inventory file very very ‚Äúcorrectly‚Äù</li>\n<li>Check your system for ‚Äúpasswordless SSH‚Äù</li>\n<li>Check the DNS server being discovered ‚Äúfirst‚Äù. This might not be the DNS server you want to use.</li>\n</ul>\n</li>\n<li>\n<p>Error: some nodes cannot install rpms from yum </p>\n<ul>\n<li>Check if the DNS server is active for your nodes</li>\n</ul>\n</li>\n<li>\n<p>Pod ‚Äòregistry-console-1-deploy‚Äô in Error STATUS </p>\n<p><a href=\"https://github.com/openshift/openshift-ansible/issues/8208\">registry-console does not start in a disconnected install ¬∑ Issue #8208 ¬∑ openshift/openshift-ansible</a></p>\n<ul>\n<li>Don‚Äôt care this. It has no effect on your journey. However, if you really want to solve this problem, please refer to <a href=\"https://www.server-world.info/en/note?os=CentOS_7&#x26;p=openshift311&#x26;f=6\">this</a>.</li>\n</ul>\n</li>\n</ol>","frontmatter":{"title":"Installation Guide for OKD 3.11","date":"November 12, 2020"}}},"pageContext":{"slug":"/OKD/installation-guide-for-okd-3.11/","previous":{"fields":{"slug":"/gatsby/custom-fonts-in-gatsby-starter-bee/"},"frontmatter":{"title":"Custom Fonts in gatsby-starter-bee","category":"gatsby","draft":false}},"next":null}},"staticQueryHashes":["3128451518","521680639"]}